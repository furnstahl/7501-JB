
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Path integrals for quantum mechanics with MCMC libraries &#8212; Quantum Mechanics I</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"N": "\\mathbb{N}", "avec": ["\\boldsymbol{a}"], "floor": ["\\lfloor#1\\rfloor", 1], "bmat": ["\\left[\\begin{array}"], "emat": ["\\end{array}\\right]"]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Quantum harmonic oscillator" href="../External/harmonic_oscillator_Jendrzejewski.html" />
    <link rel="prev" title="Tests of exponentiating derivative operators" href="../Numerical_derivative_tests.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Quantum Mechanics I</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../about.html">
                    About Physics 7501: Quantum Mechanics I
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course overview
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/Course/overview.html">
   Objectives
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Notebooks for 7501
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Numerical_derivative_tests.html">
   Exponentiating operators
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Path integral explorations
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  External QM notebooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../External/harmonic_oscillator_Jendrzejewski.html">
   Quantum harmonic oscillator
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../External/Example_Quantum_Calculations_sympy.html">
   QM with Sympy
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../content/External/OSSCAR_notebooks.html">
   QM notebooks from OSSCAR
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../External/quantum-mechanics_from_OSSCAR/1quantumwell.html">
     Finite well in 1D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../External/quantum-mechanics_from_OSSCAR/2quantumwells.html">
     Two finite wells in 1D
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../External/quantum-mechanics_from_OSSCAR/shooting_method.html">
     Shooting Method with Numerov Algorithm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../External/quantum-mechanics_from_OSSCAR/soft.html">
     TD S-eqn using SOFT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../External/quantum-mechanics_from_OSSCAR/msoft.html">
     TD S-eqn using MSOFT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../External/quantum-mechanics_from_OSSCAR/asymmetricwell.html">
     Avoided crossing example
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Math notebooks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../External/Quantitative_Economics_with_Python_complex_numbers_and_trig.html">
   Complex Numbers and Trigonometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../External/Quantitative_Economics_with_Python_linear_algebra.html">
   Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../External/Quantitative_Economics_with_Python_svd_intro.html">
   Singular Value Decomposition (SVD)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting started with Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/Reference/installing_anaconda.html">
   Using Anaconda
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../content/Reference/python_jupyter.html">
   Python and Jupyter notebooks
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Reference/Jupyter_Python_intro_01.html">
     Python and Jupyter notebooks: part 01
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Reference/Jupyter_Python_intro_02.html">
     Python and Jupyter notebooks: part 02
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/Reference/advanced.html">
     Advanced topics
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference material
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/zbibliography.html">
   Bibliography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/Reference/using_github.html">
   Using GitHub
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/jb_tests.html">
   Examples: Jupyter jb-book
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/furnstahl/7501-JB/main?urlpath=tree/./notebooks/Path_integrals/Lepage_Lattice_QCD_for_Novices_code_selfcontained.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/furnstahl/7501-JB"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/furnstahl/7501-JB/issues/new?title=Issue%20on%20page%20%2Fnotebooks/Path_integrals/Lepage_Lattice_QCD_for_Novices_code_selfcontained.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/Path_integrals/Lepage_Lattice_QCD_for_Novices_code_selfcontained.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#path-integral-basics">
   Path integral basics
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#formal-aspects">
     Formal aspects
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numerical-implementation">
     Numerical implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-matrix-elements">
     Other matrix elements
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numerical-evaluation-with-mcmc">
     Numerical evaluation with MCMC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bootstrap-and-binning">
     Bootstrap and binning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#higher-order-discretization">
     Higher-order discretization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#python-imports">
   Python imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#classes-and-functions-for-path-integrals">
   Classes and functions for path integrals
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#d-potential-class">
   1-d potential class
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#harmonic-oscillator-definitions">
     Harmonic Oscillator definitions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#make-some-plots">
     Make some plots
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#metropolis-calculation-section-2-2-of-lepage-lectures">
   Metropolis calculation (section 2.2 of Lepage lectures)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#class-for-path-integral">
   Class for path integral
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discretize-time">
     Discretize time
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-the-number-of-configurations-to-generate-nconfig-and-the-correlation-time-ncorr">
     Set the number of configurations to generate (Nconfig) and the correlation time (Ncorr)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-the-metropolis-procedure-for-the-energy">
     Set up the Metropolis procedure for the energy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-of-emcee">
     Test of emcee
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#try-with-zeus">
     Try with zeus
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#trying-a-larger-lattice-spacing-a">
     Trying a larger lattice spacing a
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Path integrals for quantum mechanics with MCMC libraries</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#path-integral-basics">
   Path integral basics
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#formal-aspects">
     Formal aspects
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numerical-implementation">
     Numerical implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-matrix-elements">
     Other matrix elements
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numerical-evaluation-with-mcmc">
     Numerical evaluation with MCMC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bootstrap-and-binning">
     Bootstrap and binning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#higher-order-discretization">
     Higher-order discretization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#python-imports">
   Python imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#classes-and-functions-for-path-integrals">
   Classes and functions for path integrals
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#d-potential-class">
   1-d potential class
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#harmonic-oscillator-definitions">
     Harmonic Oscillator definitions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#make-some-plots">
     Make some plots
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#metropolis-calculation-section-2-2-of-lepage-lectures">
   Metropolis calculation (section 2.2 of Lepage lectures)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#class-for-path-integral">
   Class for path integral
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discretize-time">
     Discretize time
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-the-number-of-configurations-to-generate-nconfig-and-the-correlation-time-ncorr">
     Set the number of configurations to generate (Nconfig) and the correlation time (Ncorr)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-the-metropolis-procedure-for-the-energy">
     Set up the Metropolis procedure for the energy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-of-emcee">
     Test of emcee
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#try-with-zeus">
     Try with zeus
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#trying-a-larger-lattice-spacing-a">
     Trying a larger lattice spacing a
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="path-integrals-for-quantum-mechanics-with-mcmc-libraries">
<h1>Path integrals for quantum mechanics with MCMC libraries<a class="headerlink" href="#path-integrals-for-quantum-mechanics-with-mcmc-libraries" title="Permalink to this headline">#</a></h1>
<p>The original reference here is Peter Lepage’s lectures entitled <em>Lattice QCD for Novices</em>, available as <a class="reference external" href="https://arxiv.org/abs/hep-lat/0506036">arXiv:hep-lat/0506036</a>. The starting point is one-dimensional quantum mechanics and that is where we focus our attention. The aim is to implement the calculations outlined by Lepage (updating some of the included Python code) and then switch to using some of the standard libraries for Markov Chain Monte Carlo (MCMC) designed for Bayesian inference.</p>
<p>To preview where we are going, the basic idea is that we can think of a discretized path in imaginary time <span class="math notranslate nohighlight">\(x(\tau)\rightarrow \{x(\tau_0), x(\tau_1), \ldots, x(\tau_{N-1})\}\)</span> as a set of <span class="math notranslate nohighlight">\(N\)</span> parameters and the path integral weighting factor <span class="math notranslate nohighlight">\(e^{-S[x(\tau)]}\)</span> as an unnormalized likelihood. We’ll combine with a uniform prior to make a posterior. If we sample the posterior with MCMC methods, we are sampling the paths according to the weighting by the action. We can use the samples to take quantum mechanical expectation values.</p>
<section id="path-integral-basics">
<h2>Path integral basics<a class="headerlink" href="#path-integral-basics" title="Permalink to this headline">#</a></h2>
<section id="formal-aspects">
<h3>Formal aspects<a class="headerlink" href="#formal-aspects" title="Permalink to this headline">#</a></h3>
<p>We start with a path integral representation for an imaginary-time evolution between position eigenstates:</p>
<div class="math notranslate nohighlight">
\[
  \langle x_f | e^{-\widehat H(\tau_f - \tau_i)} | x_i \rangle = \int \mathcal{D}x(\tau)\, e^{-S[x(\tau)]}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\tau = it\)</span> and</p>
<div class="math notranslate nohighlight">
\[
  \mathcal{D}x(\tau) \longrightarrow \mbox{sum over paths } \{x(\tau) \mbox{ where } \tau_i \leq \tau \leq \tau_f\}
  \mbox{ with } x_i = x(\tau_i),\ x_f = x(\tau_f) .
\]</div>
<p>The Hamiltonian is <span class="math notranslate nohighlight">\(\widehat H\)</span> and <span class="math notranslate nohighlight">\(S[x(\tau)]\)</span> is the classical action evaluated for path <span class="math notranslate nohighlight">\(x(\tau)\)</span>:</p>
<div class="math notranslate nohighlight">
\[
  S[x(\tau)] \equiv \int_{\tau_i}^{\tau_f} d\tau\, L(x,\dot x; \tau)
    = \int_{\tau_i}^{\tau_f} d\tau\, \biggl[\frac{1}{2}m \dot x(\tau)^2 + V(x(\tau))\biggr] .
\]</div>
<p>This is the <em>Euclidean</em> version of <span class="math notranslate nohighlight">\(S\)</span> and the Lagrangian <span class="math notranslate nohighlight">\(L\)</span>, which is why the relative sign of the kinetic and potential terms is positive (i.e., <span class="math notranslate nohighlight">\(L = T_E + V\)</span> rather than <span class="math notranslate nohighlight">\(L = T - V\)</span>).</p>
<p>If we insert on the left side a complete set of exact eigenstates of <span class="math notranslate nohighlight">\(\widehat H\)</span> (labeled by <span class="math notranslate nohighlight">\(n\)</span>), namely</p>
<div class="math notranslate nohighlight">
\[
   \mathbb{1} = \sum_n |E_n\rangle \langle E_n| 
   \quad\mbox{where}\quad \widehat H |E_n\rangle = E_n |E_n\rangle ,
\]</div>
<p>then we can use <span class="math notranslate nohighlight">\(e^{-\widehat H (\tau_f - \tau_i)}|E_n\rangle = e^{-E_n(\tau_f-\tau_i)}|E_n\rangle\)</span> (which follows after a power series expansion of the exponential) to obtain</p>
<div class="math notranslate nohighlight">
\[
  \langle x_f | e^{-\widehat H(\tau_f - \tau_i)} | x_i \rangle 
     = \sum_n \langle x_f |E_n\rangle e^{-E_n(\tau_f-\tau_i)} \langle E_n | x_i\rangle ,
\]</div>
<p>which involves both the wave functions and energy eigenvalues. Because <span class="math notranslate nohighlight">\(E_0 &lt; E_{n\neq 0}\)</span>, we can take <span class="math notranslate nohighlight">\(T \equiv \tau_f - \tau_i \rightarrow \infty\)</span> to isolate the first terms (all the others are suppressed exponentially relative to the first). We have the freedom to take <span class="math notranslate nohighlight">\(x_f = x_i \equiv x\)</span>, which yields in the large time limit:</p>
<div class="math notranslate nohighlight">
\[
  \langle x | e^{-\widehat H T} | x \rangle \overset{T\rightarrow\infty}{\longrightarrow}
    e^{-E_0 T} |\langle x | E_0\rangle|^2 .
\]</div>
<p>The wavefunction <span class="math notranslate nohighlight">\(\psi_{E_0}(x) = \langle x|E_0\rangle\)</span> is normalized, so</p>
<div class="math notranslate nohighlight">
\[
  \int_{-\infty}^{\infty} \langle x | e^{-\widehat H T} | x \rangle \overset{T\rightarrow\infty}{\longrightarrow}
    e^{-E_0 T} 
\]</div>
<p>and we get the energy (then we can go back and divide out this factor to get the wave function squared).</p>
<p>To derive the path integral formerly, we divide up the Euclidean time interval from <span class="math notranslate nohighlight">\(\tau_i\)</span> to <span class="math notranslate nohighlight">\(\tau_f\)</span> into little intervals of width <span class="math notranslate nohighlight">\(\Delta \tau\)</span> and insert a complete set of <span class="math notranslate nohighlight">\(x\)</span> states in each time. This enables us to approximate <span class="math notranslate nohighlight">\(e^{-\widehat H\Delta\tau}\)</span> in each interval. In a full derivation we would insert both momentum and coordinate states and evaluate the matrix element of <span class="math notranslate nohighlight">\(\widehat H(\hat p,\hat x)\)</span>. The small <span class="math notranslate nohighlight">\(\Delta\tau\)</span> lets us neglect the commutator between <span class="math notranslate nohighlight">\(\hat p\)</span> and <span class="math notranslate nohighlight">\(\hat x\)</span> as higher order (proportional to <span class="math notranslate nohighlight">\(\Delta\tau^2\)</span>) If we then do all the momentum integrals, we get the path integral over <span class="math notranslate nohighlight">\(\mathcal{D}x(\tau)\)</span>.</p>
</section>
<section id="numerical-implementation">
<h3>Numerical implementation<a class="headerlink" href="#numerical-implementation" title="Permalink to this headline">#</a></h3>
<p>In the formal discussion of path integrals, a path is defined at every continuous point in Euclidan time <span class="math notranslate nohighlight">\(\tau\)</span>, but to represent this on a computer (and actually make a sensible definition), we discretize the time:</p>
<div class="math notranslate nohighlight">
\[  
  \tau_i \leq \tau \leq \tau_f \quad\longrightarrow\quad \tau_j = \tau_i + j a \ \mbox{for }j = 0,\ldots,N
\]</div>
<p>with grid (mesh) spacing <span class="math notranslate nohighlight">\(a\)</span>:</p>
<div class="math notranslate nohighlight">
\[
   a \equiv \frac{\tau_f - \tau_i}{N} .
\]</div>
<p>A path is then a list of numbers:</p>
<div class="math notranslate nohighlight">
\[
   x(\tau)\rightarrow \{x(\tau_0), x(\tau_1), \ldots, x(\tau_{N-1})\}
\]</div>
<p>and the integration over all paths becomes a conventional multiple integral over the values of <span class="math notranslate nohighlight">\(x_j\)</span> at each <span class="math notranslate nohighlight">\(\tau_j\)</span> for <span class="math notranslate nohighlight">\(1 \leq j \leq N-1\)</span>:</p>
<div class="math notranslate nohighlight">
\[
   \int \mathcal{D}x(\tau) \longrightarrow A \int_{-\infty}^{\infty} dx_1 \int_{-\infty}^{\infty} dx_2
     \cdots \int_{-\infty}^{\infty} dx_{N-1} .
\]</div>
<p>The endpoints <span class="math notranslate nohighlight">\(x_0\)</span> and <span class="math notranslate nohighlight">\(x_N\)</span> are determined by the boundary conditions (e.g., <span class="math notranslate nohighlight">\(x_0 = x_N = x\)</span> as used above). If we need the normalization <span class="math notranslate nohighlight">\(A\)</span> (which we often won’t because it will drop out), then for the one-dimensional problems here it is</p>
<div class="math notranslate nohighlight">
\[
    A = \left(\frac{m}{2\pi a}\right)^{N/2} .
\]</div>
<p>We will need an approximation to the action. Here is one choice for <span class="math notranslate nohighlight">\(\tau_{j} \leq \tau \leq \tau_{j+1}\)</span>:</p>
<div class="math notranslate nohighlight">
\[
  \int_{\tau_{j}}^{\tau_{j+1}} d\tau\, L \approx
    a \left[ \frac{m}{2} \left(\frac{x_{j+1}-x_{j}}{a}\right)^2 
             + \frac{1}{2} \bigl( V(x_{j+1}) + V(x_{j}) \bigr)
      \right]
\]</div>
<p>Now we have</p>
<div class="math notranslate nohighlight">
\[
  \langle x | e^{-\widehat H \tau} | x \rangle \approx
    A \int_{-\infty}^{\infty} dx_1 \int_{-\infty}^{\infty} dx_2
     \cdots \int_{-\infty}^{\infty} dx_{N-1} e^{-S_{\rm lat}[x]}
\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[
   S_{\rm lat}[x] \equiv \sum_{j=0}^{N-1} 
     \left[  
      \frac{m}{2a}(x_{j+1}-x_{j})^2 + a V(x_j)
     \right]
\]</div>
<p>with <span class="math notranslate nohighlight">\(x_0 = x_N = x\)</span> and <span class="math notranslate nohighlight">\(a = T/N\)</span>.</p>
<p>Comments:</p>
<ul class="simple">
<li><p>One might worry about the discretization of the derivatives, because of the range of the <span class="math notranslate nohighlight">\(x_{j}\)</span>’s: adjacent points can be arbitrarily far away (the paths can be arbitrarily “rough”).</p></li>
</ul>
</section>
<section id="other-matrix-elements">
<h3>Other matrix elements<a class="headerlink" href="#other-matrix-elements" title="Permalink to this headline">#</a></h3>
<p>Suppose we wanted a Euclidean expectation value:</p>
<div class="math notranslate nohighlight">
\[
  \langle\langle x(\tau_2)x(\tau_1) \rangle\rangle
   \equiv \frac{\int \mathcal{D}x(\tau)\, x(\tau_2)x(\tau_1)\,e^{-S[x]}}{\int \mathcal{D}x(\tau)\, e^{-S[x]}}
\]</div>
<p>where there is an integration over <span class="math notranslate nohighlight">\(x_i = x_f = x\)</span> as well as over the intermediate <span class="math notranslate nohighlight">\(x(t)\)</span>’s. Note that we are calculating a weighted average of <span class="math notranslate nohighlight">\(x(\tau_2)x(\tau_1)\)</span> over all paths, where the weighting factor is <span class="math notranslate nohighlight">\(e^{-S[x]}\)</span>. This means that for every path, we take the values of <span class="math notranslate nohighlight">\(x\)</span> at <span class="math notranslate nohighlight">\(\tau_2\)</span> and <span class="math notranslate nohighlight">\(\tau_1\)</span> and multiply them together, with the weight <span class="math notranslate nohighlight">\(e^{-S[x]}\)</span> that involves the entire path.</p>
<p>In the continuum form, the right side is</p>
<div class="math notranslate nohighlight">
\[
  \int dx\, \langle x| e^{-\widehat H(\tau_f-\tau_2)} \hat x e^{-\widehat H(\tau_2-\tau_1)}
    \hat x e^{-\widehat H(\tau_1-\tau_i)} | x \rangle ,
\]</div>
<p>so with <span class="math notranslate nohighlight">\(T = \tau_f - \tau_i\)</span> and <span class="math notranslate nohighlight">\(\tau = \tau_2 - \tau_1\)</span>, we can insert our complete set of eigenstates to derive</p>
<div class="math notranslate nohighlight">
\[
    \langle\langle x(\tau_2)x(\tau_1) \rangle\rangle =
    \frac{\sum_n e^{-E_n T} \langle E_n | \hat x e^{-(\widehat H-E_n)\tau}\hat x | E_n\rangle}{\sum_n e^{-E_n T}}
\]</div>
<p>Once again, for large <span class="math notranslate nohighlight">\(T\)</span> the ground state will dominate the sums, so</p>
<div class="math notranslate nohighlight">
\[
  G(\tau) \equiv \langle\langle x(\tau_2)x(\tau_1) \rangle\rangle \longrightarrow
     \langle E_0 | \hat x e^{-(\widehat H - E_0)\tau} \hat x | E_0 \rangle .
\]</div>
<p>But what state propagates in the middle? It could be any created by <span class="math notranslate nohighlight">\(\hat x\)</span> acting on the ground state. But this doesn’t <em>include</em> the ground state because <span class="math notranslate nohighlight">\(\hat x\)</span> switches the parity of the state (from even to odd). We can insert a complete set of states again, and if <span class="math notranslate nohighlight">\(\tau \ll T\)</span> is large itself, then the first excited state <span class="math notranslate nohighlight">\(|E_1\rangle\)</span> will be projected out:</p>
<div class="math notranslate nohighlight">
\[
  G(\tau) \overset{\tau\ {\rm large}}{\longrightarrow} |\langle E_0 | \hat x | E_1 \rangle|^2
    e^{-(E_1-E_0)\tau} .
\]</div>
<p>Given <span class="math notranslate nohighlight">\(G(\tau)\)</span>, we can use the <span class="math notranslate nohighlight">\(\tau\)</span> dependence of the exponential (and <span class="math notranslate nohighlight">\(\tau\)</span> independence of the squared matrix element) to isolate the excitation energy and then the matrix element:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
  \log(G(\tau)/G(\tau+a) &amp;\overset{\tau\ {\rm large}}{\longrightarrow} (E_1 - E_0)a \\
  |\langle E_0 | \hat x | E_1 \rangle|^2 &amp;\overset{\tau\ {\rm large}}{\longrightarrow} G(\tau)e^{+(E_1-E_0)\tau} 
\end{align}\end{split}\]</div>
<p>We can, in principle, generalize to an arbitrary function of <span class="math notranslate nohighlight">\(x\)</span>, call it <span class="math notranslate nohighlight">\(\Gamma[x]\)</span>, and compute any physical property of the excited states. We can also compute thermal averages at finite <span class="math notranslate nohighlight">\(T\)</span>:</p>
<div class="math notranslate nohighlight">
\[
  \langle\langle \Gamma[x] \rangle\rangle = 
    \frac{\sum_n e^{-E_n T} \langle E_n | \Gamma[\hat x] | E_n\rangle}{\sum_n e^{-E_n T}}
    \quad\mbox{with } T \rightarrow \beta \equiv \frac{1}{k_B T_{\rm temp}} .
\]</div>
</section>
<section id="numerical-evaluation-with-mcmc">
<h3>Numerical evaluation with MCMC<a class="headerlink" href="#numerical-evaluation-with-mcmc" title="Permalink to this headline">#</a></h3>
<p>The idea of the Monte Carlo evaluation of</p>
<div class="math notranslate nohighlight">
\[
 \langle\langle \Gamma[x] \rangle\rangle = 
   \frac{\int\mathcal{D}x(\tau)\, \Gamma[x]e^{-S[x]}}{\int\mathcal{D}x(\tau)\, e^{-S[x]}}
\]</div>
<p>is that this is a weighted average of <span class="math notranslate nohighlight">\(\Gamma[x]\)</span> over paths, so if we generate a set of paths that are distributed according to <span class="math notranslate nohighlight">\(e^{-S[x]}\)</span> (that is, the relative probability of a given path is proportional to this factor), then we can just do a direct average of <span class="math notranslate nohighlight">\(\Gamma[x]\)</span> over this set.</p>
<p>To be explicit, we will generate a large number <span class="math notranslate nohighlight">\(N_{\rm cf}\)</span> of random paths (“configurations” or cf)</p>
<div class="math notranslate nohighlight">
\[
    x^{(\alpha)} \equiv \{ x_0^{(\alpha)}, x_1^{(\alpha)}, \ldots, x_{N-1}^{(\alpha)} \}
      \quad \alpha = 1,2,\ldots N_{\rm cf}
\]</div>
<p>on the time grid such that the probability of getting a particular path <span class="math notranslate nohighlight">\(x^{(\alpha)}\)</span> is</p>
<div class="math notranslate nohighlight">
\[
     P[x^{(\alpha)}] \propto e^{-S[x^{(\alpha)}]} .
\]</div>
<p>Then</p>
<div class="math notranslate nohighlight">
\[
   \langle\langle \Gamma[x] \rangle\rangle \approx \overline\Gamma \equiv
       \frac{1}{N_{\rm cf}}\sum_{\alpha=1}^{N_{\rm cf}} \Gamma[x^{(\alpha)}] .
\]</div>
<p>This is equivalent to approximating the probability distribution as</p>
<div class="math notranslate nohighlight">
\[
     P[x] \approx \frac{1}{N_{\rm cf}}\sum_{\alpha=1}^{N_{\rm cf}} \delta(x - x^{(\alpha)}) . 
\]</div>
<p>where the delta function is the product of delta functions for each of the <span class="math notranslate nohighlight">\(x_j\)</span>’s. Note that this representation is automatically normalized simply by including the <span class="math notranslate nohighlight">\(1/N_{\rm cf}\)</span> factor.</p>
<p>How good is the estimate? With a finite number of paths <span class="math notranslate nohighlight">\(N_{\rm cf}\)</span> there is clearly a statistical error <span class="math notranslate nohighlight">\(\sigma_{\overline\Gamma}\)</span>, which he can estimate by calculating the variance using are set of paths:</p>
<div class="math notranslate nohighlight">
\[
  \sigma_{\overline\Gamma}^2 = \frac{\langle\langle \Gamma^2 \rangle\rangle - \langle\langle  \Gamma\rangle\rangle^2}{N_{\rm cf}}
  \approx \frac{1}{N_{\rm cf}} \left\{  
      \frac{1}{N_{\rm cf}} \sum_{\alpha=1}^{N_{\rm cf}} \Gamma^2[x^{(\alpha)}] - \overline\Gamma^2
  \right\} .
\]</div>
<p>The numerator for large <span class="math notranslate nohighlight">\(N_{\rm cf}\)</span> is independent of <span class="math notranslate nohighlight">\(N_{\rm cf}\)</span> (e.g., it can be calculated directly, in principle, from quantum mechanics), so the error decreases as <span class="math notranslate nohighlight">\(\sigma_{\overline\Gamma} \propto 1/\sqrt{N_{\rm cf}}\)</span> with increasing <span class="math notranslate nohighlight">\(N_{\rm cf}\)</span>.</p>
<p>We can use Markov Chain Monte Carlo (MCMC) to generate our sample of paths, first by the Metropolis algorithm and then by more sophisticated methods. Starting from an arbitrary path <span class="math notranslate nohighlight">\(x^{(0)}\)</span>, we generate a series of subsequent paths by considering each lattice site in turn, randomizing the <span class="math notranslate nohighlight">\(x_j\)</span>’s at these sites according to the algorithm, to generate a new path, and then repeat until we have <span class="math notranslate nohighlight">\(N_{\rm cf}\)</span> random paths. The Metropolis algorithm applied to <span class="math notranslate nohighlight">\(x_j\)</span> at the <span class="math notranslate nohighlight">\(j^{\rm th}\)</span> site is:</p>
<ul class="simple">
<li><p>generate a random number <span class="math notranslate nohighlight">\(\zeta \sim U(-\epsilon,\epsilon)\)</span>, that is <span class="math notranslate nohighlight">\(\zeta\)</span> is uniformly distributed from <span class="math notranslate nohighlight">\(-\zeta\)</span> to <span class="math notranslate nohighlight">\(+\zeta\)</span>, for a constant <em>step size</em> <span class="math notranslate nohighlight">\(\epsilon\)</span> (see later);</p></li>
<li><p>replace <span class="math notranslate nohighlight">\(x_j \rightarrow x_j + \zeta\)</span> and compute the change <span class="math notranslate nohighlight">\(\Delta S\)</span> in the action as a result of this replacement (local Lagrangian means this only requires considering a few terms);</p></li>
<li><p>if <span class="math notranslate nohighlight">\(\Delta S &lt; 0\)</span> (action reduced) then retain new <span class="math notranslate nohighlight">\(x_j\)</span> and move to the next site;</p></li>
<li><p>if <span class="math notranslate nohighlight">\(\Delta S &gt; 0\)</span>, generate a random number <span class="math notranslate nohighlight">\(\eta \sim U(0,1)\)</span> (uniform from 0 to 1) and retain the new <span class="math notranslate nohighlight">\(x_j\)</span> if <span class="math notranslate nohighlight">\(e^{-\Delta S} &gt; \eta\)</span>, else restore the old <span class="math notranslate nohighlight">\(x_j\)</span>; move to the next site.</p></li>
</ul>
<p>Comments:</p>
<ul class="simple">
<li><p>Whether or not many of the <span class="math notranslate nohighlight">\(x_j\)</span>’s do not change in successive paths depends a lot on <span class="math notranslate nohighlight">\(\epsilon\)</span>. If <span class="math notranslate nohighlight">\(\epsilon\)</span> is very large, then the changes in <span class="math notranslate nohighlight">\(x_j\)</span> are large and many or most will be rejected; if <span class="math notranslate nohighlight">\(\epsilon\)</span> is very small, then the changes in <span class="math notranslate nohighlight">\(x_j\)</span> are small and most will be accepted, but the path will be close to the same.</p></li>
<li><p>Neither situation is good: both slow down the exploration of the space of important paths.</p></li>
<li><p>Claim: usually tune <span class="math notranslate nohighlight">\(\epsilon\)</span> so 40% to 60% of the <span class="math notranslate nohighlight">\(x_j\)</span>’s change on each sweep. This implies that <span class="math notranslate nohighlight">\(\epsilon\)</span> is the same order as the typical quantum fluctuations expected.</p></li>
<li><p>Because the paths take time to get decorrelated, we should only keep every <span class="math notranslate nohighlight">\(N_{\rm cor}\)</span> path. The optimal value can be determined empirically; here the optimal <span class="math notranslate nohighlight">\(N_{\rm cor}\)</span> depends on <span class="math notranslate nohighlight">\(a\)</span> as <span class="math notranslate nohighlight">\(1/a^2\)</span>.</p></li>
<li><p>When starting the algorithm, the first configuration is atypical (usually). So we should have a thermalization period where the first paths are discarded. Recommendation: five to ten times <span class="math notranslate nohighlight">\(N_{\rm cor}\)</span> should be discarded.</p></li>
</ul>
</section>
<section id="bootstrap-and-binning">
<h3>Bootstrap and binning<a class="headerlink" href="#bootstrap-and-binning" title="Permalink to this headline">#</a></h3>
</section>
<section id="higher-order-discretization">
<h3>Higher-order discretization<a class="headerlink" href="#higher-order-discretization" title="Permalink to this headline">#</a></h3>
<p>Suppose we rewrite the action for one-dimensional quantum mechanics by integrating the kinetic term by parts (assuming <span class="math notranslate nohighlight">\(x(\tau_i)=x(\tau_f)=x\)</span>:</p>
<div class="math notranslate nohighlight">
\[
  S[x] \equiv \int_{\tau_i}^{\tau_f} d\tau\, \bigl[-\frac{1}{2}m x(\tau)\ddot x(\tau) + V(x(\tau))\bigr]
\]</div>
<p>The discretization is</p>
<div class="math notranslate nohighlight">
\[
  \ddot x(t) \longrightarrow \Delta^{(2)}x_j \equiv \frac{x_{j+1}-2x_{j}+x_{j-1}}{a^2}
\]</div>
<p>where the <span class="math notranslate nohighlight">\(x_j\)</span>’s wrap around at the ends: <span class="math notranslate nohighlight">\(x_0 = x_{N}\)</span>, <span class="math notranslate nohighlight">\(x_{-1} = x_{N-1}\)</span>, and so on.</p>
</section>
</section>
<section id="python-imports">
<h2>Python imports<a class="headerlink" href="#python-imports" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">uniform</span><span class="p">,</span> <span class="n">normal</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span><span class="p">;</span> <span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;darkgrid&quot;</span><span class="p">);</span> <span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;talk&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="classes-and-functions-for-path-integrals">
<h2>Classes and functions for path integrals<a class="headerlink" href="#classes-and-functions-for-path-integrals" title="Permalink to this headline">#</a></h2>
<p>These are from Lepage’s lectures. Not yet incorporated here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="n">G</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Do a bootstrap</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N_cf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    <span class="n">G_bootstrap</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># new ensemble</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N_cf</span><span class="p">):</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N_cf</span><span class="p">))</span>  <span class="c1"># choose random config</span>
        <span class="n">G_bootstrap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="n">alpha</span><span class="p">])</span>  <span class="c1"># keep G[alpha] </span>
    <span class="k">return</span> <span class="n">G_bootstrap</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bin</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">binsize</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Binning</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">G_binned</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># binned ensemble </span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="p">),</span> <span class="n">binsize</span><span class="p">):</span> <span class="c1">#loop on bins</span>
        <span class="n">G_avg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">binsize</span><span class="p">):</span> <span class="c1"># loop on bin elements</span>
            <span class="n">G_avg</span> <span class="o">=</span> <span class="n">G_avg</span> <span class="o">+</span> <span class="n">G</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> 
        <span class="n">G_binned</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">G_avg</span> <span class="o">/</span> <span class="n">binsize</span><span class="p">)</span> <span class="c1"># keep bin average</span>
    <span class="k">return</span> <span class="n">G_binned</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="d-potential-class">
<h2>1-d potential class<a class="headerlink" href="#d-potential-class" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Potential</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A general class for potentials</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hbar : float</span>
<span class="sd">        Planck&#39;s constant. Equals 1 by default</span>
<span class="sd">    mu : float</span>
<span class="sd">        Reduced mass. Equals 1 by default</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    V(x)</span>
<span class="sd">        Returns the value of the potential at x.</span>
<span class="sd">    </span>
<span class="sd">    E_gs</span>
<span class="sd">        Returns the analytic ground-state energy, if known</span>
<span class="sd">        </span>
<span class="sd">    wf_gs(x)</span>
<span class="sd">        Returns the analytic ground-state wave function, if known</span>
<span class="sd">        </span>
<span class="sd">    plot_V(ax, x_pts)</span>
<span class="sd">        Plots the potential at x_pts on ax</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hbar</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">V_string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hbar</span> <span class="o">=</span> <span class="n">hbar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_string</span> <span class="o">=</span> <span class="n">V_string</span>
        
    <span class="k">def</span> <span class="nf">V</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Potential at x</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The potential is not defined.&#39;</span><span class="p">)</span> 
        
    <span class="k">def</span> <span class="nf">E_gs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        analytic ground state energy, if known</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The ground state energy is not known analytically.&#39;</span><span class="p">)</span> 
        
    <span class="k">def</span> <span class="nf">wf_gs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        analytic ground state wave function, if known</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The ground state wave function is not known analytically.&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">plot_V</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x_pts</span><span class="p">,</span> <span class="n">V_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the potential on the given axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="n">x_pts</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">V_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="harmonic-oscillator-definitions">
<h3>Harmonic Oscillator definitions<a class="headerlink" href="#harmonic-oscillator-definitions" title="Permalink to this headline">#</a></h3>
<p>We’ll do the one-dimensional harmonic oscillator (ho), by default in units where the basic quantities are all unity.  In these units, the energies should be (n+1/2), where n = 0,1,2,3,…).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">V_HO</span><span class="p">(</span><span class="n">Potential</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Harmonic oscillator potential (subclass of Potential)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k_osc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hbar</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">V_string</span><span class="o">=</span><span class="s1">&#39;Harmonic oscillator&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_osc</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">hbar</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">V_string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">V</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Standard harmonic oscillator potential for particle at x&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_osc</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span><span class="mi">2</span>
    
    <span class="k">def</span> <span class="nf">E_gs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        1D harmonic oscillator ground-state energy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hbar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_osc</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="p">)</span>  <span class="c1"># ground state energy </span>
        
    <span class="k">def</span> <span class="nf">wf_gs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        1D harmonic oscillator ground-state wave function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># We should  put the units back!</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">V_aHO</span><span class="p">(</span><span class="n">Potential</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclass of Potential</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k_osc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hbar</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">V_string</span><span class="o">=</span><span class="s1">&#39;Anharmonic oscillator&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_osc</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">hbar</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">V_string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">V</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Anharmonic oscillator potential for particle at x&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_osc</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="make-some-plots">
<h3>Make some plots<a class="headerlink" href="#make-some-plots" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instantiate a harmonic oscillator potential</span>
<span class="n">mass</span> <span class="o">=</span> <span class="mf">1.</span>  
<span class="n">k_osc</span> <span class="o">=</span> <span class="mf">1.</span>  <span class="c1"># oscillator constant </span>
<span class="n">hbar</span> <span class="o">=</span> <span class="mf">1.</span> 

<span class="n">test_ho</span> <span class="o">=</span> <span class="n">V_HO</span><span class="p">(</span><span class="n">k_osc</span><span class="p">,</span> <span class="n">hbar</span><span class="p">,</span> <span class="n">mass</span><span class="p">)</span>
<span class="n">test_aho</span> <span class="o">=</span> <span class="n">V_aHO</span><span class="p">(</span><span class="n">k_osc</span><span class="p">,</span> <span class="n">hbar</span><span class="p">,</span> <span class="n">mass</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the wave function and potential</span>
<span class="n">x_pts_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">.01</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="c1">#ax.set_ylabel(r&#39;g(x)&#39;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>

<span class="n">test_ho</span><span class="o">.</span><span class="n">plot_V</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">x_pts_all</span><span class="p">,</span> <span class="n">V_label</span><span class="o">=</span><span class="s1">&#39;HO potential&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pts_all</span><span class="p">,</span> <span class="n">test_ho</span><span class="o">.</span><span class="n">wf_gs</span><span class="p">(</span><span class="n">x_pts_all</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;gs wf&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">test_ho</span><span class="o">.</span><span class="n">V_string</span><span class="si">}</span><span class="s1"> with k_osc = </span><span class="si">{</span><span class="n">k_osc</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">, mass = </span><span class="si">{</span><span class="n">mass</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_23_0.png" src="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_23_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Normalization check of wave function squared</span>
<span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">(</span><span class="n">test_ho</span><span class="o">.</span><span class="n">wf_gs</span><span class="p">(</span><span class="n">x_pts_all</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x_pts_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9999999839221155
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="metropolis-calculation-section-2-2-of-lepage-lectures">
<h2>Metropolis calculation (section 2.2 of Lepage lectures)<a class="headerlink" href="#metropolis-calculation-section-2-2-of-lepage-lectures" title="Permalink to this headline">#</a></h2>
<p>Now instead of an integration over all paths, we want to select a representative sampling of the “paths” that are distributed according to <span class="math notranslate nohighlight">\(e^{-S[x]}\)</span>.  If we succeed, we can take an unweighted average over these paths to approximate the weighted average over uniformly distributed paths.</p>
<p>We will use the Metropolis algorithm to generate a sequence of paths.</p>
<p>Define a function to initialize the first path, which is set to zero at each of the Npts times:</p>
<p>We update the path following the Metropolis algorithm:</p>
<ol class="simple">
<li><p>Step through each time point from j = 0 to Npts-1</p></li>
<li><p>Save the value of the path at current time point j</p></li>
<li><p>Calculate the current value of the action (only considering contributions that depend on j with speed)</p></li>
<li><p>Generate a random number xi from -epsilon to epsilon and consider x_j –&gt; x_j + xi</p></li>
<li><p>Find Delta S (change in the action) for this change:<br />
a. If Delta S &lt; 0 (action reduced), keep new x_j and go to next value of j.<br />
b. If Delta S &gt; 0 (action increased), generate eta between 0 and 1. Keep new x_j if exp(-Delta S) &gt; eta, otherwise keep old value and move on to the next j.</p></li>
<li><p>In general we keep track of the “success” rate and adjust epsilon so that it is about 50% successes.</p></li>
</ol>
<p>Define a function to do this update and print the new path at the end.</p>
<p>Define a function to calculate the contribution to the Hamiltonian (the energy) from time point j:</p>
<p>To do:</p>
<ul class="simple">
<li><p>Check for equilibration</p></li>
<li><p>Check for autocorrelation</p></li>
<li><p>Histogram the energy calculations and compare to the expected error</p></li>
</ul>
</section>
<section id="class-for-path-integral">
<h2>Class for path integral<a class="headerlink" href="#class-for-path-integral" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Modules needed for example: emcee is for MCMCsampling, corner for plotting</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">emcee</span>
<span class="kn">import</span> <span class="nn">corner</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PathIntegral</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for a path integral for 1D quantum mechanics. Associated with an </span>
<span class="sd">    instance of the class is:</span>
<span class="sd">      * a potential with the Potential superclass but a particular subclass</span>
<span class="sd">      * a lattice definition</span>
<span class="sd">      * settings for correlation and thermalization &quot;times&quot; (Monte Carlo steps)</span>
<span class="sd">      * method for updating</span>
<span class="sd">      * method for averaging</span>
<span class="sd">      * list of configurations (paths)</span>
<span class="sd">      * choice of by-hand Metropolis updating or using emcee, zeus, or pyMC3</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Delta_T</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">N_pts</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">N_config</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">N_corr</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span>
                 <span class="n">V_pot</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Delta_T</span> <span class="o">=</span> <span class="n">Delta_T</span>        <span class="c1"># DeltaT --&gt; &quot;a&quot; in Lepage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N_pts</span> <span class="o">=</span> <span class="n">N_pts</span>            <span class="c1"># N_pts --&gt; &quot;N&quot; in Lepage </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_max</span> <span class="o">=</span> <span class="n">Delta_T</span> <span class="o">*</span> <span class="n">N_pts</span>  <span class="c1"># Tmax --&gt; &quot;T&quot; in Lepage</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">N_config</span> <span class="o">=</span> <span class="n">N_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N_corr</span> <span class="o">=</span> <span class="n">N_corr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">V_pot</span> <span class="o">=</span> <span class="n">V_pot</span>  <span class="c1"># member of Potential class</span>
        
        <span class="c1">#self.x_path = np.zeros(self.N_pts)</span>
        <span class="c1">#self.list_of_paths = </span>
        
        
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a path to zeros if eps=None otherwise to random numbers from </span>
<span class="sd">        a normal distribution with mean zero and standard deviation eps.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">eps</span><span class="p">:</span>
            <span class="n">x_path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">eps</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_pts</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_pts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x_path</span>

    <span class="k">def</span> <span class="nf">S_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Contribution to the action from path x_path </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pts</span><span class="p">):</span>        
            <span class="n">j_plus</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pts</span>
            <span class="n">x_j</span> <span class="o">=</span> <span class="n">x_path</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">x_j_plus</span> <span class="o">=</span> <span class="n">x_path</span><span class="p">[</span><span class="n">j_plus</span><span class="p">]</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">action</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Delta_T</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_pot</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="n">x_j</span><span class="p">)</span> \
              <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V_pot</span><span class="o">.</span><span class="n">mu</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Delta_T</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_j_plus</span> <span class="o">-</span> <span class="n">x_j</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">action</span>    

    <span class="k">def</span> <span class="nf">S_lattice_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_path</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to calculate the contribution to action S from terms with j</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">j_plus</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pts</span>  <span class="c1"># next j point, wrapping around if needed</span>
        <span class="n">j_minus</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pts</span>
        <span class="n">x_j_minus</span> <span class="o">=</span> <span class="n">x_path</span><span class="p">[</span><span class="n">j_minus</span><span class="p">]</span>
        <span class="n">x_j</span> <span class="o">=</span> <span class="n">x_path</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">x_j_plus</span> <span class="o">=</span> <span class="n">x_path</span><span class="p">[</span><span class="n">j_plus</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Delta_T</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_pot</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="n">x_j</span><span class="p">)</span> \
               <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_pot</span><span class="o">.</span><span class="n">mu</span> <span class="o">*</span> <span class="n">x_j</span> <span class="o">*</span> \
                 <span class="p">(</span><span class="n">x_j</span> <span class="o">-</span> <span class="n">x_j_plus</span> <span class="o">-</span> <span class="n">x_j_minus</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Delta_T</span>            

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           This is a Metropolis update of the passed path.</span>
<span class="sd">            * x_path is an array of length N_pts</span>
<span class="sd">            * Step through each element and generate a candidate new value</span>
<span class="sd">               generated uniformly between -eps and +eps.</span>
<span class="sd">            * Check how much the action changes. Keep the new value *unless*</span>
<span class="sd">               the action increases *and* e^{-change} &lt; uniform(0,1); that is</span>
<span class="sd">               even if the action increases, keep it with probability e^{-change}.    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pts</span><span class="p">):</span>
            <span class="n">old_x_path</span> <span class="o">=</span> <span class="n">x_path</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="c1"># save original value </span>
            <span class="n">old_Sj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_lattice_j</span><span class="p">(</span><span class="n">x_path</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            
            <span class="n">x_path</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_path</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span> <span class="c1"># update x_path[j]</span>
            <span class="n">dS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_lattice_j</span><span class="p">(</span><span class="n">x_path</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="n">old_Sj</span> <span class="c1"># change in action </span>
            <span class="k">if</span> <span class="n">dS</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dS</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">x_path</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_x_path</span>  <span class="c1"># restore old value</span>
        <span class="k">return</span> <span class="n">x_path</span>

    <span class="k">def</span> <span class="nf">H_lattice_j</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_path</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Contribution to the energy from time point j</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">j_plus</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pts</span>
        <span class="n">x_j</span> <span class="o">=</span> <span class="n">x_path</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">x_j_plus</span> <span class="o">=</span> <span class="n">x_path</span><span class="p">[</span><span class="n">j_plus</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Delta_T</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_pot</span><span class="o">.</span><span class="n">V</span><span class="p">(</span><span class="n">x_j</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V_pot</span><span class="o">.</span><span class="n">mu</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Delta_T</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_j_plus</span> <span class="o">-</span> <span class="n">x_j</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="k">def</span> <span class="nf">display_x_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print out x_path&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x_path</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">MC_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accumulate paths after thermalization, skipping every N_corr</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>  <span class="c1"># initialize x_path </span>
        
        <span class="c1"># thermalize x_path</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_corr</span><span class="p">):</span>
            <span class="n">x_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x_path</span><span class="p">)</span> 
        <span class="n">list_of_paths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_path</span><span class="p">])</span>
        
        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_config</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="c1"># for every count, skip N_corr paths</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_corr</span><span class="p">):</span>
                <span class="n">x_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x_path</span><span class="p">)</span>
            <span class="c1"># add the last one to the list</span>
            <span class="n">list_of_paths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_of_paths</span><span class="p">,</span> <span class="p">[</span><span class="n">x_path</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list_of_paths</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">Gamma_avg_over_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">list_of_paths</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the average of Gamma(x_path, n) for tau point n over the</span>
<span class="sd">        paths in list_of_paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N_paths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_paths</span><span class="p">)</span>
        <span class="c1">#print(&#39;Npaths = &#39;, N_paths)</span>
        <span class="n">Gamma_avg</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">x_path</span> <span class="ow">in</span> <span class="n">list_of_paths</span><span class="p">:</span>
            <span class="n">Gamma_avg</span> <span class="o">=</span> <span class="n">Gamma_avg</span> <span class="o">+</span> <span class="n">Gamma</span><span class="p">(</span><span class="n">x_path</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Gamma_avg</span> <span class="o">/</span> <span class="n">N_paths</span>    
    
    <span class="k">def</span> <span class="nf">E_avg_over_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_paths</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Average the lattice Hamiltonian over a set of configurations in</span>
<span class="sd">        list_of_paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N_paths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_paths</span><span class="p">)</span>
        <span class="c1">#print(&#39;Npaths = &#39;, N_paths)</span>
        <span class="n">E_avg</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">x_path</span> <span class="ow">in</span> <span class="n">list_of_paths</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_pts</span><span class="p">):</span>
                <span class="n">E_avg</span> <span class="o">=</span> <span class="n">E_avg</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">H_lattice_j</span><span class="p">(</span><span class="n">x_path</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">E_avg</span> <span class="o">/</span> <span class="p">(</span><span class="n">N_paths</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pts</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">compute_G</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_path</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the correlator &lt;&lt; x(t_j) x(t_{j+n}) &gt;&gt; averaged over </span>
<span class="sd">        j = 1, ..., N_pts, where n corresponds to tau, i.e., tau = n * Delta_t.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N_tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pts</span>
        <span class="n">g</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N_tau</span><span class="p">):</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">g</span> <span class="o">+</span> <span class="n">x_path</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">x_path</span><span class="p">[(</span><span class="n">j</span><span class="o">+</span><span class="n">n</span><span class="p">)</span><span class="o">%</span><span class="k">N_tau</span>] # wrap around as needed
        <span class="k">return</span> <span class="n">g</span> <span class="o">/</span> <span class="n">N_tau</span>
    
            
</pre></div>
</div>
</div>
</div>
<section id="discretize-time">
<h3>Discretize time<a class="headerlink" href="#discretize-time" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Delta_T</span> <span class="o">=</span> <span class="mf">0.25</span>           <span class="c1"># DeltaT --&gt; &quot;a&quot; in Lepage</span>
<span class="n">N_pts</span> <span class="o">=</span> <span class="mi">20</span>              <span class="c1"># N_pts --&gt; &quot;N&quot; in Lepage </span>
<span class="n">Tmax</span> <span class="o">=</span> <span class="n">Delta_T</span> <span class="o">*</span> <span class="n">N_pts</span>   <span class="c1"># Tmax --&gt; &quot;T&quot; in Lepage</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-the-number-of-configurations-to-generate-nconfig-and-the-correlation-time-ncorr">
<h3>Set the number of configurations to generate (Nconfig) and the correlation time (Ncorr)<a class="headerlink" href="#set-the-number-of-configurations-to-generate-nconfig-and-the-correlation-time-ncorr" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N_config</span> <span class="o">=</span> <span class="mi">100</span>   <span class="c1"># We&#39;ll want to try 25, 100, 1000, 10000 </span>
<span class="n">N_corr</span> <span class="o">=</span> <span class="mi">20</span>      <span class="c1"># Lepage recommends 20 or so </span>
<span class="n">eps</span> <span class="o">=</span> <span class="mf">1.4</span>  <span class="c1"># suggested epsilon</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-up-the-metropolis-procedure-for-the-energy">
<h3>Set up the Metropolis procedure for the energy<a class="headerlink" href="#set-up-the-metropolis-procedure-for-the-energy" title="Permalink to this headline">#</a></h3>
<p>Here is the basic plan:</p>
<ol class="simple">
<li><p>Initialize the first path to all zeros for x_j.</p></li>
<li><p>Do (5-10)*Ncorr updates to thermalize the path.</p></li>
<li><p>Update Ncorr times, keep that path (or do the calculation of the energy with that path).</p></li>
<li><p>Repeat the last step Nconfig times.</p></li>
<li><p>Average the Nconfig values of the energy to get the estimate.</p></li>
</ol>
<p>Ok, let’s set it up!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instantiate a harmonic oscillator potential</span>
<span class="n">mass</span> <span class="o">=</span> <span class="mf">1.</span>  
<span class="n">k_osc</span> <span class="o">=</span> <span class="mf">1.</span>  <span class="c1"># oscillator constant </span>
<span class="n">hbar</span> <span class="o">=</span> <span class="mf">1.</span> 

<span class="n">test_ho</span> <span class="o">=</span> <span class="n">V_HO</span><span class="p">(</span><span class="n">k_osc</span><span class="p">,</span> <span class="n">hbar</span><span class="p">,</span> <span class="n">mass</span><span class="p">)</span>
<span class="n">test_aho</span> <span class="o">=</span> <span class="n">V_aHO</span><span class="p">(</span><span class="n">k_osc</span><span class="p">,</span> <span class="n">hbar</span><span class="p">,</span> <span class="n">mass</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">testPI</span> <span class="o">=</span> <span class="n">PathIntegral</span><span class="p">(</span><span class="n">V_pot</span><span class="o">=</span><span class="n">test_ho</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_path</span> <span class="o">=</span> <span class="n">testPI</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>
<span class="n">testPI</span><span class="o">.</span><span class="n">display_x_path</span><span class="p">(</span><span class="n">x_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 0.20910173  0.10921192  0.03947866  0.23273774  0.07226791 -0.0140061
 -0.17469999  0.03862063 -0.12133458  0.00302452  0.15887871 -0.13730878
  0.09600179 -0.04234114 -0.07080546  0.00082348  0.07230063  0.14296251
 -0.06848006 -0.05019278]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">testPI</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">x_path</span><span class="p">)</span>
<span class="n">testPI</span><span class="o">.</span><span class="n">display_x_path</span><span class="p">(</span><span class="n">x_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 0.20910173  0.18176197  0.03947866  0.23273774  0.07226791 -0.0140061
 -0.17469999  0.03862063 -0.12133458  0.00302452  0.15887871 -0.13730878
  0.83483115  0.84891617  0.49987133  0.5165895   0.07230063  0.14296251
  0.33038004  0.41607604]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Delta_T</span> <span class="o">=</span> <span class="mf">0.25</span>           <span class="c1"># Delta_T --&gt; &quot;a&quot; in Lepage</span>
<span class="n">N_pts</span> <span class="o">=</span> <span class="mi">20</span>               <span class="c1"># N_pts --&gt; &quot;N&quot; in Lepage </span>
<span class="n">Tmax</span> <span class="o">=</span> <span class="n">Delta_T</span> <span class="o">*</span> <span class="n">N_pts</span>   <span class="c1"># Tmax --&gt; &quot;T&quot; in Lepage</span>

<span class="n">N_config</span> <span class="o">=</span> <span class="mi">4000</span>  <span class="c1"># We&#39;ll want to try 25, 100, 1000, 10000 </span>
<span class="n">N_corr</span> <span class="o">=</span> <span class="mi">20</span>      <span class="c1"># Lepage recommends 20 or so </span>
<span class="n">eps</span> <span class="o">=</span> <span class="mf">1.4</span>        <span class="c1"># suggested epsilon</span>

<span class="n">new_PI</span> <span class="o">=</span> <span class="n">PathIntegral</span><span class="p">(</span><span class="n">Delta_T</span><span class="o">=</span><span class="n">Delta_T</span><span class="p">,</span> <span class="n">N_pts</span><span class="o">=</span><span class="n">N_pts</span><span class="p">,</span> <span class="n">N_config</span><span class="o">=</span><span class="n">N_config</span><span class="p">,</span> 
                      <span class="n">N_corr</span><span class="o">=</span><span class="n">N_corr</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">V_pot</span><span class="o">=</span><span class="n">test_ho</span><span class="p">)</span>

<span class="n">list_of_paths</span> <span class="o">=</span> <span class="n">new_PI</span><span class="o">.</span><span class="n">MC_paths</span><span class="p">()</span>

<span class="c1">#print(f&#39;Energy = {E_mean:.5f} +/- {E_sem:.5f}&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">list_of_paths</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">E_avg</span> <span class="o">=</span> <span class="n">new_PI</span><span class="o">.</span><span class="n">E_avg_over_paths</span><span class="p">(</span><span class="n">list_of_paths</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average over </span><span class="si">{</span><span class="n">N_config</span><span class="si">}</span><span class="s1"> configurations is </span><span class="si">{</span><span class="n">E_avg</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4000, 20)
Average over 4000 configurations is 0.50028
</pre></div>
</div>
</div>
</div>
<p>At this point we could increase Nconfig to get a better answer or run it many times and average:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_PI</span> <span class="o">=</span> <span class="n">PathIntegral</span><span class="p">(</span><span class="n">Delta_T</span><span class="o">=</span><span class="n">Delta_T</span><span class="p">,</span> <span class="n">N_pts</span><span class="o">=</span><span class="n">N_pts</span><span class="p">,</span> <span class="n">N_config</span><span class="o">=</span><span class="n">N_config</span><span class="p">,</span> 
                      <span class="n">N_corr</span><span class="o">=</span><span class="n">N_corr</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">V_pot</span><span class="o">=</span><span class="n">test_ho</span><span class="p">)</span>

<span class="n">list_of_paths</span> <span class="o">=</span> <span class="n">new_PI</span><span class="o">.</span><span class="n">MC_paths</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">energy_avg</span><span class="p">(</span><span class="n">N_trials</span><span class="p">,</span> <span class="n">N_config_each</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the mean and standard deviation of N_trials of the energy</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">my_PI</span> <span class="o">=</span> <span class="n">PathIntegral</span><span class="p">(</span><span class="n">Delta_T</span><span class="o">=</span><span class="n">Delta_T</span><span class="p">,</span> <span class="n">N_pts</span><span class="o">=</span><span class="n">N_pts</span><span class="p">,</span> <span class="n">N_config</span><span class="o">=</span><span class="n">N_config_each</span><span class="p">,</span> 
                      <span class="n">N_corr</span><span class="o">=</span><span class="n">N_corr</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">V_pot</span><span class="o">=</span><span class="n">test_ho</span><span class="p">)</span>
    <span class="n">E_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_trials</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_trials</span><span class="p">):</span>
        <span class="n">short_list</span> <span class="o">=</span> <span class="n">my_PI</span><span class="o">.</span><span class="n">MC_paths</span><span class="p">()</span>
        <span class="n">E_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_PI</span><span class="o">.</span><span class="n">E_avg_over_paths</span><span class="p">(</span><span class="n">short_list</span><span class="p">)</span>
    <span class="c1">#print(E_list)</span>
    <span class="n">E_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">E_list</span><span class="p">)</span>
    <span class="n">E_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">E_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">E_mean</span><span class="p">,</span> <span class="n">E_std</span><span class="p">,</span> <span class="n">E_std</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N_trials</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">E_mean</span><span class="p">,</span> <span class="n">E_std</span><span class="p">,</span> <span class="n">E_sem</span> <span class="o">=</span> <span class="n">energy_avg</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Energy = </span><span class="si">{</span><span class="n">E_mean</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">E_sem</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Energy = 0.49449 +/- 0.00312
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy_means</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">energy_stds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">energy_sems</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">N_trials</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_trials</span><span class="p">):</span>
    <span class="c1"># energy_avg()</span>
    <span class="n">E_mean</span><span class="p">,</span> <span class="n">E_std</span><span class="p">,</span> <span class="n">E_sem</span> <span class="o">=</span> <span class="n">energy_avg</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># average over 10 </span>
    <span class="c1">#print(E_mean)</span>
    <span class="n">energy_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy_means</span><span class="p">,</span> <span class="n">E_mean</span><span class="p">)</span>
    <span class="n">energy_stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy_stds</span><span class="p">,</span> <span class="n">E_std</span><span class="p">)</span>    
    <span class="n">energy_sems</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">energy_sems</span><span class="p">,</span> <span class="n">E_sem</span><span class="p">)</span>    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a histogram plot of the energy and compare to expected width</span>
<span class="n">expect_std</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">energy_sems</span><span class="p">)</span>
<span class="n">actual_std</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">energy_means</span><span class="p">)</span>

<span class="n">mean_of_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">energy_means</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The mean of the energy means is </span><span class="si">{</span><span class="n">mean_of_means</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$100 \times (E_{\rm gs} - 0.5) $&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;# of counts&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">fr</span><span class="s1">&#39;$100 \times$ (Expected std = </span><span class="si">{</span><span class="n">expect_std</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">; actual std = </span><span class="si">{</span><span class="n">actual_std</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">energy_means</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;energy&#39;</span><span class="p">)</span>

<span class="c1"># ax.axhline(0., color=&#39;black&#39;, alpha=0.5, linestyle=&#39;dotted&#39;)</span>
<span class="c1"># ax.plot(x_pts_all, V_HO(x_pts_all), color=&#39;blue&#39;, alpha=1, label=&#39;HO potential&#39;)</span>
<span class="c1"># ax.plot(x_pts_all, HO_gs_wf(x_pts_all), color=&#39;red&#39;, alpha=1, label=&#39;gs wf&#39;)</span>
<span class="c1"># ax.set_title(f&#39;Harmonic oscillator with k_osc = {k_osc:.1f}, mass = {mass:.1f}&#39;)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The mean of the energy means is 0.49958
</pre></div>
</div>
<img alt="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_50_1.png" src="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_50_1.png" />
</div>
</div>
</section>
<section id="test-of-emcee">
<h3>Test of emcee<a class="headerlink" href="#test-of-emcee" title="Permalink to this headline">#</a></h3>
<p>We’ll take <span class="math notranslate nohighlight">\(\theta\)</span> to be the values of <span class="math notranslate nohighlight">\(x\)</span> at each of the <code class="docutils literal notranslate"><span class="pre">N_pts</span></code> time points. We’ll choose the prior to be uniform in a reasonable range of <span class="math notranslate nohighlight">\(x\)</span>. Lepage suggests <span class="math notranslate nohighlight">\(-5 \leq x \leq +5\)</span> is large enough to have negligible effect. Here <code class="docutils literal notranslate"><span class="pre">X</span></code> will be data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.</span>
<span class="n">x_max</span> <span class="o">=</span> <span class="o">+</span><span class="mf">5.</span>
<span class="n">min_theta</span> <span class="o">=</span> <span class="n">x_min</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N_pts</span><span class="p">)</span>
<span class="n">max_theta</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N_pts</span><span class="p">)</span>
<span class="n">volume_theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">max_theta</span><span class="o">-</span><span class="n">min_theta</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">log_prior</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Log prior for parameter array theta&#39;&#39;&#39;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">==</span><span class="n">N_pts</span><span class="p">,</span> <span class="s2">&quot;Parameter vector must have length N_pts.&quot;</span>
    <span class="c1"># flat prior </span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">min_theta</span><span class="o">&lt;=</span><span class="n">theta</span><span class="p">,</span> <span class="n">theta</span><span class="o">&lt;=</span><span class="n">max_theta</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span> 
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">volume_theta</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

<span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">path_integral</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Log likelihood for path integral given parameter array theta</span>
<span class="sd">        is given by minus the action for that path.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">path_integral</span><span class="o">.</span><span class="n">S_lattice</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

<span class="k">def</span> <span class="nf">log_posterior</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">path_integral</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Log posterior for path integral given parameter array theta&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">log_prior</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">log_likelihood</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">path_integral</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_integral</span> <span class="o">=</span> <span class="n">new_PI</span>
<span class="n">N_corr</span> <span class="o">=</span> <span class="mi">20</span>      <span class="c1"># Lepage recommends 20 or so </span>

<span class="n">ndim</span> <span class="o">=</span> <span class="n">N_pts</span>  <span class="c1"># number of parameters in the model</span>
<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># number of MCMC walkers</span>
<span class="n">nburn</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">N_corr</span>  <span class="c1"># &quot;burn-in&quot; period to let chains stabilize</span>
<span class="n">nsteps</span> <span class="o">=</span> <span class="mi">20000</span>  <span class="c1"># number of MCMC steps to take</span>

<span class="c1"># we&#39;ll start at random locations within the prior volume</span>
<span class="c1"># we&#39;ll change this to normal distribution</span>
<span class="c1"># starting_guesses = min_theta + \</span>
<span class="c1">#                    (max_theta - min_theta) * np.random.rand(nwalkers,ndim)</span>
<span class="n">starting_guesses</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_max</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span><span class="n">ndim</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MCMC sampling using emcee (affine-invariant ensamble sampler) with </span><span class="si">{</span><span class="n">nwalkers</span><span class="si">}</span><span class="s2"> walkers&quot;</span><span class="p">)</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">log_posterior</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">path_integral</span><span class="p">])</span>

<span class="c1"># &quot;burn-in&quot; period; save final positions and then reset</span>
<span class="n">pos</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">starting_guesses</span><span class="p">,</span> <span class="n">nburn</span><span class="p">)</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="c1"># sampling period</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean acceptance fraction: </span><span class="si">{0:.3f}</span><span class="s2"> (in total </span><span class="si">{1}</span><span class="s2"> steps)&quot;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">acceptance_fraction</span><span class="p">),</span><span class="n">nwalkers</span><span class="o">*</span><span class="n">nsteps</span><span class="p">))</span>

<span class="c1"># discard burn-in points and flatten the walkers; the shape of samples is (nwalkers*nsteps, ndim)</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ndim</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MCMC sampling using emcee (affine-invariant ensamble sampler) with 50 walkers
Mean acceptance fraction: 0.297 (in total 1000000 steps)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># tau = sampler.get_autocorr_time()</span>
<span class="c1"># print(tau)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">E_avg</span> <span class="o">=</span> <span class="n">new_PI</span><span class="o">.</span><span class="n">E_avg_over_paths</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average over </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">nwalkers</span><span class="o">*</span><span class="n">nsteps</span><span class="p">)</span><span class="si">}</span><span class="s1"> configurations is </span><span class="si">{</span><span class="n">E_avg</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1000000, 20)
Average over 1000000 configurations is 0.49965
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples_thinned</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="n">N_corr</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">samples_thinned</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">E_avg</span> <span class="o">=</span> <span class="n">new_PI</span><span class="o">.</span><span class="n">E_avg_over_paths</span><span class="p">(</span><span class="n">samples_thinned</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average over </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">nwalkers</span><span class="o">*</span><span class="n">nsteps</span><span class="o">/</span><span class="n">N_corr</span><span class="p">)</span><span class="si">}</span><span class="s1"> configurations is </span><span class="si">{</span><span class="n">E_avg</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(50000, 20)
Average over 50000 configurations is 0.49936
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a corner plot with the posterior distribution</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="nb">str</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_pts</span><span class="p">)]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">samples_thinned</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                    <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">],</span>
                    <span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_57_0.png" src="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_57_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the wave function and potential</span>
<span class="n">x_pts_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">.01</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="c1">#ax.set_ylabel(r&#39;g(x)&#39;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">)</span>
<span class="c1">#ax.set_ylim(-0.1, 1.)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>

<span class="c1">#test_ho.plot_V(ax, x_pts_all, V_label=&#39;HO potential&#39;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_pts_all</span><span class="p">,</span> <span class="n">test_ho</span><span class="o">.</span><span class="n">wf_gs</span><span class="p">(</span><span class="n">x_pts_all</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s1">&#39;(gs wf)$</span><span class="se">{{}}</span><span class="s1">^2$&#39;</span><span class="p">)</span>
<span class="c1">#ax.hist(samples[:,3], bins=np.arange(x_min, x_max, .1), density=True)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="mf">.1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#ax.hist(samples[:,1], bins=100, density=True)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">test_ho</span><span class="o">.</span><span class="n">V_string</span><span class="si">}</span><span class="s1"> with k_osc = </span><span class="si">{</span><span class="n">k_osc</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">, mass = </span><span class="si">{</span><span class="n">mass</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_58_0.png" src="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_58_0.png" />
</div>
</div>
</section>
<section id="try-with-zeus">
<h3>Try with zeus<a class="headerlink" href="#try-with-zeus" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">zeus</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_integral</span> <span class="o">=</span> <span class="n">new_PI</span>
<span class="n">N_corr</span> <span class="o">=</span> <span class="mi">20</span>      <span class="c1"># Lepage recommends 20 or so </span>

<span class="n">ndim</span> <span class="o">=</span> <span class="n">N_pts</span>  <span class="c1"># number of parameters in the model</span>
<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># number of MCMC walkers</span>
<span class="n">nburn</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">N_corr</span>  <span class="c1"># &quot;burn-in&quot; period to let chains stabilize</span>
<span class="n">nsteps</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># number of MCMC steps to take</span>

<span class="c1"># we&#39;ll start at random locations within the prior volume</span>
<span class="c1"># we&#39;ll change this to normal distribution</span>
<span class="c1"># starting_guesses = min_theta + \</span>
<span class="c1">#                    (max_theta - min_theta) * np.random.rand(nwalkers,ndim)</span>
<span class="n">starting_guesses</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_max</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span><span class="n">ndim</span><span class="p">)</span>
<span class="c1">#starting_guesses = (x_max/100) * np.random.randn(nwalkers,ndim)</span>

<span class="c1"># Do the burn-in with nburn steps</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MCMC sampling using zeus (ensamble slice sampler) with </span><span class="si">{</span><span class="n">nwalkers</span><span class="si">}</span><span class="s2"> walkers&quot;</span><span class="p">)</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">zeus</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">log_posterior</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">path_integral</span><span class="p">])</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">starting_guesses</span><span class="p">,</span> <span class="n">nburn</span><span class="p">)</span>

<span class="c1"># Get the burn-in samples</span>
<span class="n">burnin</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">()</span>

<span class="c1"># reset the start</span>
<span class="n">starting_guesses</span> <span class="o">=</span> <span class="n">burnin</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># now do the post-burn-in sampling with nsteps steps</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">zeus</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">log_posterior</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">path_integral</span><span class="p">])</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">starting_guesses</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initialising ensemble of 50 walkers...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MCMC sampling using zeus (ensamble slice sampler) with 50 walkers
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling progress : 100%|████████████████████| 200/200 [00:01&lt;00:00, 101.63it/s]
Initialising ensemble of 50 walkers...
Sampling progress : 100%|██████████████████| 1000/1000 [00:09&lt;00:00, 103.12it/s]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chain_thinned</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="n">N_corr</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">chain_thinned</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">E_avg</span> <span class="o">=</span> <span class="n">new_PI</span><span class="o">.</span><span class="n">E_avg_over_paths</span><span class="p">(</span><span class="n">chain_thinned</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average over </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">nwalkers</span><span class="o">*</span><span class="n">nsteps</span><span class="o">/</span><span class="n">N_corr</span><span class="p">)</span><span class="si">}</span><span class="s1"> configurations is </span><span class="si">{</span><span class="n">E_avg</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2500, 20)
Average over 2500 configurations is 0.49061
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chain</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">discard</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">chain</span><span class="o">.</span><span class="n">shape</span>

<span class="n">E_avg</span> <span class="o">=</span> <span class="n">new_PI</span><span class="o">.</span><span class="n">E_avg_over_paths</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average over </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">nwalkers</span><span class="o">*</span><span class="n">nsteps</span><span class="p">)</span><span class="si">}</span><span class="s1"> configurations is </span><span class="si">{</span><span class="n">E_avg</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average over 50000 configurations is 0.48813
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mf">1.5</span><span class="o">*</span><span class="n">ndim</span><span class="p">))</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">ndim</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">()[:,:,</span><span class="n">n</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="c1">#plt.plot(chain[:,n],alpha=0.5)</span>
    <span class="c1">#plt.axhline(y=mu[n])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_65_0.png" src="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_65_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mf">1.5</span><span class="o">*</span><span class="n">ndim</span><span class="p">))</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">ndim</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1">#plt.plot(sampler.get_chain()[:,:,n],alpha=0.5)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">chain</span><span class="p">[:,</span><span class="n">n</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="c1">#plt.axhline(y=mu[n])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_66_0.png" src="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_66_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a corner plot with the posterior distribution</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                    <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">],</span>
                    <span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_67_0.png" src="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_67_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Try the zeus corner plot routine, using every 10</span>
<span class="c1"># fig, axes = zeus.cornerplot(chain[::10], size=(8,8))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="trying-a-larger-lattice-spacing-a">
<h3>Trying a larger lattice spacing a<a class="headerlink" href="#trying-a-larger-lattice-spacing-a" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Delta_T</span> <span class="o">=</span> <span class="mf">0.50</span>           <span class="c1"># Delta_T --&gt; &quot;a&quot; in Lepage</span>
<span class="n">N_pts</span> <span class="o">=</span> <span class="mi">20</span>               <span class="c1"># N_pts --&gt; &quot;N&quot; in Lepage </span>
<span class="n">Tmax</span> <span class="o">=</span> <span class="n">Delta_T</span> <span class="o">*</span> <span class="n">N_pts</span>   <span class="c1"># Tmax --&gt; &quot;T&quot; in Lepage</span>

<span class="n">N_config</span> <span class="o">=</span> <span class="mi">4000</span>  <span class="c1"># We&#39;ll want to try 25, 100, 1000, 10000 </span>
<span class="n">N_corr</span> <span class="o">=</span> <span class="mi">20</span>      <span class="c1"># Lepage recommends 20 or so </span>
<span class="n">eps</span> <span class="o">=</span> <span class="mf">1.4</span>        <span class="c1"># suggested epsilon</span>

<span class="n">new_PI</span> <span class="o">=</span> <span class="n">PathIntegral</span><span class="p">(</span><span class="n">Delta_T</span><span class="o">=</span><span class="n">Delta_T</span><span class="p">,</span> <span class="n">N_pts</span><span class="o">=</span><span class="n">N_pts</span><span class="p">,</span> <span class="n">N_config</span><span class="o">=</span><span class="n">N_config</span><span class="p">,</span> 
                      <span class="n">N_corr</span><span class="o">=</span><span class="n">N_corr</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">V_pot</span><span class="o">=</span><span class="n">test_ho</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_of_paths</span> <span class="o">=</span> <span class="n">new_PI</span><span class="o">.</span><span class="n">MC_paths</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">list_of_paths</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">E_avg</span> <span class="o">=</span> <span class="n">new_PI</span><span class="o">.</span><span class="n">E_avg_over_paths</span><span class="p">(</span><span class="n">list_of_paths</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average over </span><span class="si">{</span><span class="n">N_config</span><span class="si">}</span><span class="s1"> configurations is </span><span class="si">{</span><span class="n">E_avg</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4000, 20)
Average over 4000 configurations is 0.50229
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">E_avg_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">new_PI</span><span class="o">.</span><span class="n">Gamma_avg_over_paths</span><span class="p">(</span><span class="n">new_PI</span><span class="o">.</span><span class="n">H_lattice_j</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">list_of_paths</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_pts</span><span class="p">)])</span>
    
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Average over </span><span class="si">{</span><span class="n">N_config</span><span class="si">}</span><span class="s1"> configurations at each n: &#39;</span><span class="p">,</span> <span class="n">E_avg_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Mean: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">E_avg_test</span><span class="p">)</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1"> +/- </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">E_avg_test</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N_pts</span><span class="p">)</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average over 4000 configurations at each n:  [0.50603173 0.50146302 0.5094825  0.50547376 0.50860078 0.51953321
 0.49374737 0.50124946 0.49631357 0.50361406 0.5071096  0.50274467
 0.50060487 0.50212266 0.49285497 0.49053934 0.49075059 0.49266733
 0.50799446 0.51295679]

Mean: 0.50229 +/- 0.00170
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g_avg_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">new_PI</span><span class="o">.</span><span class="n">Gamma_avg_over_paths</span><span class="p">(</span><span class="n">new_PI</span><span class="o">.</span><span class="n">compute_G</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">list_of_paths</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_pts</span><span class="p">)])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">g_avg_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.49146899 0.30175624 0.18532718 0.11510977 0.07086724 0.04251234
 0.02714493 0.01639136 0.00889712 0.007087   0.00573866 0.007087
 0.00889712 0.01639136 0.02714493 0.04251234 0.07086724 0.11510977
 0.18532718 0.30175624]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DeltaE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">g_avg_test</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="n">g_avg_test</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">Delta_T</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_pts</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">DeltaE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 0.97555858  0.97499354  0.95247311  0.97015595  1.02202794  0.89720827
  1.00887213  1.22205313  0.45492961  0.42207358 -0.42207358 -0.45492961
 -1.22205313 -1.00887213 -0.89720827 -1.02202794 -0.97015595 -0.95247311
 -0.97499354]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the wave function and potential</span>
<span class="n">t_pts_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">N_pts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">Delta_T</span><span class="p">,</span> <span class="n">Delta_T</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\tau$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta E(\tau)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">3.7</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_pts_all</span><span class="p">,</span> <span class="n">DeltaE</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="c1">#ax.legend()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_75_0.png" src="../../_images/Lepage_Lattice_QCD_for_Novices_code_selfcontained_75_0.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "furnstahl/7501-JB",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/Path_integrals"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../Numerical_derivative_tests.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Tests of exponentiating derivative operators</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../External/harmonic_oscillator_Jendrzejewski.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Quantum harmonic oscillator</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Dick Furnstahl<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>